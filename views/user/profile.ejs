<main class="main">


    <section>
        <div class="container">
            <div class="main-body">

                <br>
                <div class="row gutters-sm">
                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex flex-column align-items-center text-center">
                                    <img src="https://bootdey.com/img/Content/avatar/avatar7.png" alt="Admin"
                                        class="rounded-circle" width="150">
                                    <div class="mt-3">
                                        <h4>
                                            <%=user.userData.name%>
                                        </h4>
                                        <!-- {{!-- <p class="text-secondary mb-1">Full Stack Developer</p>
                    <p class="text-muted font-size-sm">Bay Area, San Francisco, CA</p> --}}
                    {{!-- <button class="btn btn-primary">Logout</button> --}} -->
                                        <a href="/edit-profile?id=<%=user.userData._id%>"><button
                                                class="btn btn-outline-primary">Edit
                                                profile</button></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card mt-3">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                                    <a href="/orders"><i class="fa-solid fa-box"> </i> Your orders</a>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">

                                    <a class="" data-bs-toggle="collapse" href="#collapseExample" role="button"
                                        aria-expanded="false" aria-controls="collapseExample">
                                        <i class="fa-solid fa-screwdriver-wrench"> </i> Account Settings</a>
                                    </a>

                                    <div class="collapse" id="collapseExample">
                                        <div class="card card-body">
                                            <a href="/change-password"><i class="fa-solid fa-key"></i> Change
                                                Password</a>
                                        </div>
                                    </div>

                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                                    <a href="/user-wallet"><i class="fa-solid fa-wallet"></i>
                                        Wallet</a>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                                    <a href="/my-coupons"><i class="fa-sharp fa-solid fa-ticket"></i> Coupons</a>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                                    <a href="/logout"><i class="fa-solid fa-arrow-right-from-bracket"></i> Logout</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="card mb-3">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-sm-3">
                                        <h6 class="mb-0">Full Name</h6>
                                    </div>
                                    <div class="col-sm-9 text-secondary">
                                        <%=user.userData.name%>
                                    </div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-sm-3">
                                        <h6 class="mb-0">Email</h6>
                                    </div>
                                    <div class="col-sm-9 text-secondary">
                                        <%=user.userData.email%>
                                    </div>
                                </div>
                                <hr>
                                <!-- {{!-- <div class="row">
                    <div class="col-sm-3">
                    <h6 class="mb-0">Phone</h6>
                    </div>
                    <div class="col-sm-9 text-secondary">
                    (239) 816-9029
                    </div>
                </div> --}}
                {{!--
                <hr> --}} -->
                                <div class="row">
                                    <div class="col-sm-3">
                                        <h6 class="mb-0">Mobile</h6>
                                    </div>
                                    <div class="col-sm-9 text-secondary">
                                        <%=user.userData.phone%>
                                    </div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-sm-3">
                                        <h6 class="mb-0">Address</h6>
                                    </div>
                                    <div class="col-sm-9 text-secondary">
                                        <% for(let i=0 ; i< user.addressData.length ; i++) { %>
                                            <ul>
                                                <li>Name: <%=user.addressData[i].name%>
                                                </li>
                                                <li>Mobile: <%=user.addressData[i].mobile%>
                                                </li>
                                                <li>Pincode: <%=user.addressData[i].pincode%>
                                                </li>
                                                <li>Address: <%=user.addressData[i].area%>,
                                                        <%=user.addressData[i].locality%>,
                                                            <%=user.addressData[i].district%>,
                                                                <%=user.addressData[i].state%>
                                                </li>
                                                <br>
                                                <li>
                                                    <a class="delete-address-btn" data-address-id="<%=user.addressData[i]._id%>" onclick="deleteAddress('<%=user.addressData[i]._id%>')"><i
                                                            class="fa-solid fa-trash"></i></a>
                                                </li>
                                            </ul>
                                            <hr>
                                            <% } %>
                                    </div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <a class="btn btn-info " target="" href="/add-address">Add address</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

</main>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<!-- Add this JavaScript code after including jQuery -->

<!-- <script>
    $(document).ready(function() {
        // Function to handle the AJAX request for deleting an address
        function deleteAddress(addressId) {
            $.ajax({
                type: "POST", // Use POST or DELETE method based on your server's API
                url: "/delete-address", // Replace this with the actual API endpoint to delete the address
                data: {
                    addressId: addressId
                },
                success: function(response) {
                    // If the address is successfully deleted, update the UI
                    if (response.success) {
                        // Remove the deleted address from the UI
                        $("a[data-address-id='" + addressId + "']").closest("ul").remove();
                    } else {
                        // Handle the case where deletion was not successful
                        alert("Failed to delete the address. Please try again.");
                    }
                },
                error: function(xhr, status, error) {
                    // Handle AJAX errors, if any
                    console.error("AJAX Error:", error);
                }
            });
        }

        // Handle click events on the "Delete" buttons
        $(".delete-address-btn").on("click", function(event) {
            event.preventDefault();
            var addressId = $(this).data("address-id");
            if (confirm("Are you sure you want to delete this address?")) {
                deleteAddress(addressId);
            }
        });
    });
</script> -->

<!-- Place this script at the end of the body or inside the head section -->
<script>
    function deleteAddress(addressId) {

    if (confirm("Are you sure you want to delete this address?")) {
        // Make an AJAX request to delete the address
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState === 4) {
                if (this.status === 200) {
                    // Successful response, remove the address from the UI
                    const addressElement = document.querySelector(`[data-address-id='${addressId}']`);
                    if (addressElement) {
                        const ulElement = addressElement.closest('ul');
                        if (ulElement) {
                            ulElement.remove();
                        } else {
                            console.error('Error: Unable to find the parent ul element for the deleted address.');
                        }
                    }
                } else {
                    // Handle the case where deletion was not successful
                    alert('Failed to delete the address. Please try again.');
                }
            }
        };

        xhttp.open('GET', `/delete-address?addressId=${addressId}`, true);
        xhttp.send();
    }
    }
</script>
